# 三种检测方法

​	Multi-Krum：算单个DO与其他DO之间的欧式距离

​	GeoMedian：Weiszfeld 算几何中位数，再计算其他点到中心点的欧式距离

​	Cluster：每个 DO 的投影向量归一化到单位球面，用余弦距离做聚类，然后把离群簇当成可疑

# 投毒检测的评估指标

- **TP（True Positive）**：该 DO 被判为投毒，且真实确实投毒。
- **TN（True Negative）**：该 DO 未被判为投毒，且真实确实未投毒。
- **FP（False Positive）**：该 DO 被判为投毒，但真实未投毒（误报）。
- **FN（False Negative）**：该 DO 未被判为投毒，但真实投毒（漏报）。

acc=(TP+TN)/total：总体准确率

prec=TP/(TP+FP) ：精确率：你标出来的“投毒 DO”里有多少是真的。误报越多，prec 越低。

rec=TP/(TP+FN) ：召回率：真实投毒 DO 有多少被抓到。漏报越多，rec 越低。

f1=2*prec*rec/(prec+rec)：精确率与召回率的折中，综合评估。

det_rate=有投毒轮次中至少抓到1个投毒DO的比例

exact_match=检测集合与真实投毒集合完全一致的比例

miss_rate=有投毒轮次中完全未检测到投毒DO的比例.

**ResNet20 结构**

- conv1: 3×3，输出 16 通道
- bn1
- layer1: 3 个 BasicBlock（通道 16）
- layer2: 3 个 BasicBlock（通道 32，首个 block 下采样）
- layer3: 3 个 BasicBlock（通道 64，首个 block 下采样）
- avgpool
- fc: 64 → num_classes（CIFAR10 为 10）

四种参数传入：

​	1.原始模型参数            2.原始模型参数的正交映射（1024维）

​	3.FC层（640）+BN层（1300）+layer3（380）        4.压缩后的正交映射（1024维）



# Label-flip

​	标签翻转投毒：定向是指，恶意的DO将指定的某个SourceLabel翻转成TargetLabel，1——>9。默认全轮次都投毒，恶意DO的所有SourceLabel均进行翻转。非定向，则会把SourceLabel随机翻转成已有Label中，随机的一个。ASR是仅评估SourceLabel的准确率。

### 	10%投毒+定向翻转

​	1.原始模型参数：[geomedian]最优，f1=87.80%，exact_match=80.00%，Multi近似，Cluster效果非常差，f1=8.33%

​	2.原始模型参数正交映射：[geomedian]最优，f1=83.72%，exact_match=70.00%，Multi近似，Cluster效果非常差，f1=11.54%

​	3.简化提取的原始模型参数：[clustering]最优，f1=95.24%，exact_match=95.00%，三种方案的准确率均有提升，f1均超过90。

​	4.简化+正交的模型参数：[clustering]最优，f1=90.48%，exact_match=95.00%,三种方案的f1较【3】有降低，仍高于【1，2】

### 	10%投毒+非定向翻转

​	1.原始模型参数：[multi_krum]最优，f1=90.48%，exact_match=90.00%，Geo近似，Cluster效果非常差，f1=22.64%，强于定向。

​	2.原始模型参数正交映射：[geomedian]最优，f1=94.74%，exact_match=90.00%，Multi近似，Cluster效果非常差，f1=15.09%

​	3.简化提取的原始模型参数：[clustering]最优，f1=95.24%，exact_match=95.00%，三种方案的准确率均有提升，f1均超过90。

​	4.简化+正交的模型参数：[geomedian]最优，f1=95.00%，exact_match=95.00%,三种方案的f1较【3】有降低，仍高于【1，2】

### 	20%投毒+定向翻转

​	1.原始模型参数：[geomedian]最优， f1=90.67%，exact_match=85.00%，Multi近似，Cluster效果非常差，f1=38.36%，强于10%下的投毒。

​	2.原始模型参数正交映射：[multi_krum]最优，f1=85.71%，exact_match=65.00%，Geo近似，Cluster效果差，f1=47.37%

​	3.简化提取的原始模型参数：[clustering]最优，f1= 96.30%，exact_match=95.00%，三种方案的准确率均有提升，f1均超过90。

​	4.简化+正交的模型参数：[clustering]最优，f1=96.30%，exact_match=95.00%。！**Geo和Multi急剧下跌**，仅为20%左右。但【3】仍然是正常的

### 	20%投毒+非定向翻转

​	1.原始模型参数：[multi_krum]最优， f1=95.00%，exact_match=95.00%，Multi近似；Cluster效果有提升，f1=70.27%，exact_match=65.00%。

​	2.原始模型参数正交映射：[multi_krum]最优，f1=96.10%，exact_match=90.00%，Geo近似，Cluster f1=61.11%，exact_match=55.00%。

​	3.简化提取的原始模型参数：[clustering]最优，f1= 96.30%，exact_match=95.00%，三种方案的准确率均有提升，f1均超过90。！与定向一致。

​	4.简化+正交的模型参数：[multi，Geo]，f1=96.20%，exact_match=95.00%。Cluster表现还不错，前5轮的f1有点低。f1=93.83%，exact_match=95.00%。**这里Geo和Multi没崩？**

### 	30%投毒+定向翻转

​	1.原始模型参数：[clustering]最优， f1=29.70%，exact_match=25.00%，Multi+Geo**全崩**，f1仅为3%，exact全0。

​	2.原始模型参数正交映射：[clustering]最优，f1=30.93%【映射后效果更优？】，exact_match=25.00%，**Multi+Geo反而还提升了？**

​	3.简化提取的原始模型参数：[clustering]最优，f1=82.14%，exact_match=75.00%，三种方案的准确率相比于【1】均有提升，f1大概为6%。cluster断档领先。

​	4.简化+正交的模型参数：[clustering]，f1=78.18%，exact_match=70.00%。Multi+Geo没太大变化，仍然很低。

### 	30%投毒+非定向翻转

​	1.原始模型参数：[clustering]最优， f1=36.73%，exact_match=30.00%，Multi+Geo**全崩**，Multi全错，exact全0。

​	2.原始模型参数正交映射：[clustering]最优，f1=46.15%【映射后效果更优？】，exact_match=40.00%，**Multi+Geo反而还提升了？**

​	3.简化提取的原始模型参数：[clustering]最优， f1=74.07%，exact_match=65.00%，三种方案的准确率相比于【1】均有提升，f1大概为6%。cluster断档领先。

​	4.简化+正交的模型参数：[clustering]，f1=82.14%，exact_match=75.00%。Multi+Geo没太大变化，仍然很低。

# Back-door

​	后门攻击：恶意的DO，将随机一定比例rate的数据，打上一个特殊的Trigger【3*3纯白色像素】，然后将该数据判定为TargetLabel。bd-ASR：是在测试集中同样打上一个触发器，看看会不会被判定为TargetLabel

### 	10%投毒，0.3rate，3*3Trigger

​	1.原始模型参数：[geomedian]最优，f1=95.00%，exact_match=95.00%，cluster仅为f1=19.23%。

​	2.原始模型参数正交映射：[geomedian+multi]最优，f1=95.00%，exact_match=90.00%。cluster的f1=11.76%。

​	3.简化提取的原始模型参数：[clustering]最优， f1=95.24%，exact_match=95.00%，三种方案的准确率相比于简化前，显著提升，f1大概为90%。

​	4.简化+正交的模型参数：[clustering]，f1=90.48%，exact_match=95.00%。Multi+Geo没太大变化，挺高的。

### 	20%投毒，0.3rate，3*3Trigger

​	1.原始模型参数：[geomedian]最优，f1=96.20%，exact_match=95.00%，cluster f1=83.12%，两个恶意DO下，准确率提升较大。

​	2.原始模型参数正交映射：[geomedian+multi]最优，f1=97.44%，exact_match=95.00%。cluster的 f1=74.67%

​	3.简化提取的原始模型参数：[Multi_krum]最优，f1=97.44%，exact_match=95.00%，三种方案的准确率相比于简化前，显著提升,三者均很高，96%左右

​	4.简化+正交的模型参数：[Multi_krum]最优，f1=96.20%，exact_match=95.00%，三种方案的准确率相比三者均很高，96%左右